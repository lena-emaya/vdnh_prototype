<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Vdnh_prototupe</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
        #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 10px;
        border-radius: 3px;
        width: 120px;
        
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #f8f8f8;
        color: #141010;
    }

    #menu a.active {
        background-color: #140D2F;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #2C2261;
    }

    .mapboxgl-popup {
        max-width: 400px;
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }
    </style>
</head>
<body>
    <nav id="menu"></nav>
<div id='map'></div>
<script>
mapboxgl.accessToken = 'pk.eyJ1IjoibGVuYWVtYXlhIiwiYSI6ImNpa3VhbXE5ZjAwMXB3eG00ajVyc2J6ZTIifQ.kmZ4yVcNrupl4H8EonM3aQ';
var map = new mapboxgl.Map({
  container: 'map', // container id
  style: 'mapbox://styles/lenaemaya/cjnwzrci100a32ro9ukssqg83', // stylesheet location
  center: [37.623516, 55.834373], 
	zoom: 13.3   // starting zoom
});


map.on('load', () => {
    map.addSource('exits', {
        type: 'geojson',
        data: "https://raw.githubusercontent.com/lena-emaya/vdnh_prototype/master/data/exits_vdnh.geojson",
    });

    map.addSource('iso_exits', {
        type: 'geojson',
        data: "https://raw.githubusercontent.com/lena-emaya/vdnh_prototype/master/data/isochrones_big.geojson",
    });
    

   
    map.addLayer({
      id: "exits_1",
      type: "symbol",
      source: "exits",
      layout: {
        "icon-image": "exit_click",
        "icon-size": [
          "interpolate",
          ["linear"],
          ["zoom"],
          10,
          0.3,
          22,
          1
         ],
        "icon-rotate": [
          "match",
          ["get", "id"],
          [7],
          215,
          [2],
          0,
          [3],
          340,
          [4],
          30,
          [5],
          83,
          [6],
          75,
          [8],
          318,
          [9],
          297,
          [10],
          226,
          [11],
          8,
          [12],
          300,
          [0, 13],
          320,
          [14],
          250,
          0
        ]
      }, "filter": ["in", "id", ""]
    }
    );



     map.addLayer({
        id: "iso_light",
        type: "fill",
        source: "iso_exits",
        paint: {
            
            "fill-color": 
                "#40AFE8",
            "fill-opacity": 0.25,
        
    },"filter": ["in", "id", ""]
    },"building");
});


map.on('click', function(e) {
        var features = map.queryRenderedFeatures(e.point, { layers: ['exits']});
        var filter = features.reduce(function(memo, feature) {
            memo.push(feature.properties.id);
            return memo;
        }, ['in', 'id']);
        map.setFilter("iso_light", filter);
        map.setFilter("exits_1", filter);
    });




 toggleLayer('1', ['strava_all'], 'Перемещения');

 function toggleLayer(id, ids, name) {
        var button = document.createElement('a');
        button.textContent = name;
        //console.log(id);
        
        button.onclick = function (e) {

          for (layers in ids) {
            var visibility = map.getLayoutProperty(ids[layers], 'visibility');
            if (visibility === 'visible') {
              map.setLayoutProperty(ids[layers], 'visibility', 'none');
              this.className = '';
              
            } else {
              this.className = 'active';
              map.setLayoutProperty(ids[layers], 'visibility', 'visible');
              
            }
          }
        };
        var layers = document.getElementById('menu');
        layers.appendChild(button);
  };
 

// map.on('click', 'amenity', function (e) {
//   var coordinates = e.features[0].geometry.coordinates.slice();
//   var description = e.features[0].properties.amenit
//   while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
//       coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
//   }

//   new mapboxgl.Popup()
//     .setLngLat(coordinates)
//     .setHTML(description)
//     .addTo(map);
// });

map.on('mouseenter', 'exits', function () {
  map.getCanvas().style.cursor = 'pointer';
});

   
map.on('mouseleave', 'exits', function () {
map.getCanvas().style.cursor = '';
});

</script>

</body>
</html>